<a class="btn-scroll-top"><i class="biolife-icon icon-left-arrow"></i></a>

<script src="<?php echo base_url('assets/js/jquery-3.4.1.min.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/bootstrap.min.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/jquery.countdown.min.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/jquery.nice-select.min.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/jquery.nicescroll.min.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/slick.min.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/biolife.framework.js'); ?>"></script>
<script src="<?php echo base_url('assets/js/functions.js'); ?>"></script>


    <!-- FOOTER -->
    <footer id="footer" class="footer layout-03">
        <div class="footer-content background-footer-03">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-9">
                        <section class="footer-item">
                            <a href="<?php echo base_url('auth/index'); ?>" class="logo footer-logo"><img src="<?php echo base_url('assets/images/PREFERRED.png'); ?>" alt="biolife logo" width="135" height="34"></a>
                            <!-- <div class="footer-phone-info">
                                <i class="biolife-icon icon-head-phone"></i>
                                <p class="r-info">
                                    <span>Got Questions ?</span>
                                    <span>(700)  9001-1909  (900) 689 -66</span>
                                </p>
                            </div> -->
                            <!-- <div class="newsletter-block layout-01">
                                <h4 class="title">Newsletter Signup</h4>
                                <div class="form-content">
                                    <form action="#" name="new-letter-foter">
                                        <input type="email" class="input-text email" value="" placeholder="Your email here...">
                                        <button type="submit" class="bnt-submit" name="ok">Sign up</button>
                                    </form>
                                </div>
                            </div> -->
                        </section>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 md-margin-top-5px sm-margin-top-50px xs-margin-top-40px">
                        <section class="footer-item">
                            <h3 class="section-title">Useful Links</h3>
                            <div class="row">
                                <div class="col-lg-6 col-sm-6 col-xs-6">
                                    <div class="wrap-custom-menu vertical-menu-2">
                                        <ul class="menu">
                                            <li><a href="">About Us</a></li>
                                            <li><a href="">Privacy Policy</a></li>
                                            <li><a href="">Our Services</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-xs-6">
                                    <div class="wrap-custom-menu vertical-menu-2">
                                        <ul class="menu">
                                            <li><a href="">Who We Are</a></li>
                                            <li><a href="">Contacts Us</a></li>
                                            <li><a href="">Testimonials</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 md-margin-top-5px sm-margin-top-50px xs-margin-top-40px">
                        <section class="footer-item">
                            <h3 class="section-title">Transport Offices</h3>
                            <div class="contact-info-block footer-layout xs-padding-top-10px">
                                <ul class="contact-lines">
                                    <li>
                                        <p class="info-item">
                                            <i class="biolife-icon icon-location"></i>
                                            <b class="desc">No. 1 Adenuga Street Ikosi Lagos </b>
                                        </p>
                                    </li>
                                    <li>
                                        <p class="info-item">
                                            <i class="biolife-icon icon-phone"></i>
                                            <b class="desc">Phone: 08099440151 , 08094546178
</b>
                                        </p>
                                    </li>
                                    <li>
                                        <p class="info-item">
                                            <i class="biolife-icon icon-letter"></i>
                                            <b class="desc">Email:  enquires@nourishedfoods.com</b>
                                        </p>
                                    </li>
                                    <li>
                                        <p class="info-item">
                                            <i class="biolife-icon icon-clock"></i>
                                            <b class="desc">Hours: 7 Days a week from 10:00 am</b>
                                        </p>
                                    </li>
                                </ul>
                            </div>
                            <div class="biolife-social inline">
                                <ul class="socials">
                                    <li><a href="" title="twitter" class="socail-btn"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                                    <li><a href="" title="facebook" class="socail-btn"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                                    <li><a href="" title="pinterest" class="socail-btn"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li>
                                    <li><a href="" title="youtube" class="socail-btn"><i class="fa fa-youtube" aria-hidden="true"></i></a></li>
                                    <li><a href="" title="instagram" class="socail-btn"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="separator sm-margin-top-70px xs-margin-top-40px"></div>
                    </div>
                    <div class="col-lg-6 col-sm-6 col-xs-12">
                        <!-- <div class="copy-right-text"><p><a href="templateshub.net">Templates Hub</a></p></div> -->
                    </div>
                    <div class="col-lg-6 col-sm-6 col-xs-12">
                        <div class="payment-methods">
                            <ul>
                                <li><a href="" class="payment-link"><img src="<?php echo base_url('assets/images/card1.jpg'); ?>" width="51" height="36" alt=""></a></li>
                                <li><a href="" class="payment-link"><img src="<?php echo base_url('assets/images/card2.jpg'); ?>" width="51" height="36" alt=""></a></li>
                                <li><a href="" class="payment-link"><img src="<?php echo base_url('assets/images/card3.jpg'); ?>" width="51" height="36" alt=""></a></li>
                                <li><a href="" class="payment-link"><img src="<?php echo base_url('assets/images/card4.jpg'); ?>" width="51" height="36" alt=""></a></li>
                                <li><a href="" class="payment-link"><img src="<?php echo base_url('assets/images/card5.jpg'); ?>" width="51" height="36" alt=""></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll Top Button -->
    <a class="btn-scroll-top"><i class="biolife-icon icon-left-arrow"></i></a>
</body>

</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
$(document).ready(function() {
    var userId = <?php echo json_encode($user_id); ?>;

    // Load cart items on page load
    if (userId) {
        loadCartItems(userId);
    }

    // Fetch cart items from the server and update the UI
    function loadCartItems(userId) {
        var url = '<?php echo base_url('auth/get_cart_items'); ?>';

        $.ajax({
            url: url,
            type: 'GET',
            data: {
                user_id: userId
            },
            success: function(response) {
                try {
                    var data = JSON.parse(response);
                    updateMiniCart(data);
                    updateShoppingCart(data);
                } catch (e) {
                    console.error('Error parsing JSON response:', e);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error fetching cart items:', status, error);
            }
        });
    }

    // Update mini cart UI
    function updateMiniCart(items) {
        var miniCartHtml = '';
        var miniCartTotalQty = 0;
        var miniCartSubtotal = 0;

        items.forEach(function(item) {
            var itemTotal = (item.quantity * item.price).toFixed(2);
            miniCartHtml += `
                <li>
                    <div class="minicart-item" data-id="${item.product_id}" data-price="${item.price}">
                        <div class="thumb">
                            <a href=""><img src="${item.product_image}" alt="${item.product_name}" width="90" height="90"></a>
                        </div>
                        <div class="left-info">
                            <div class="product-title"><a href="" class="product-name">${item.product_name}</a></div>
                            <div class="price">
                                <ins><span class="price-amount">#${parseFloat(item.price).toFixed(2)}</span></ins>
                                <del><span class="price-amount">#${parseFloat(item.original_price).toFixed(2)}</span></del>
                            </div>
                            <div class="qty">
                                <label for="cart[${item.product_id}][qty]">Qty:</label>
                                <input type="number" class="input-qty" name="cart[${item.product_id}][qty]" id="cart[${item.product_id}][qty]" value="${item.quantity}" min="1" max="10" data-product-id="${item.product_id}">
                            </div>
                        </div>
                        <div class="action">
                            <a href="#" class="edit"><i class="fa fa-pencil" aria-hidden="true"></i></a>
                            <a href="#" class="remove-cart-item" data-product-id="${item.product_id}" data-price="${item.price}"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
                        </div>
                    </div>
                </li>
            `;
            miniCartTotalQty += item.quantity;
            miniCartSubtotal += parseFloat(itemTotal);
        });

        $('.products').html(miniCartHtml);
        $('#minicart-quantity').text(miniCartTotalQty.length - 1);
        $('#minicart-total').text('#' + miniCartSubtotal.toFixed(2));

        attachQuantityChangeHandler(); // Re-attach the quantity change handler
    }

    // Update shopping cart UI
    function updateShoppingCart(items) {
        var shoppingCartHtml = '';
        var shoppingCartTotal = 0;

        items.forEach(function(item) {
            var itemTotal = (item.quantity * item.price).toFixed(2);
            shoppingCartHtml += `
                <tr class="cart-item" data-id="${item.product_id}" data-user-id="${userId}" data-price="${item.price}">
                    <td class="product">
                        <div class="product-thumb">
                            <a href=""><img src="${item.product_image}" alt="${item.product_name}" width="90" height="90"></a>
                        </div>
                       
                    </td>
                      <td class="product">
                        <h4 class="product-title"><a href="">${item.product_name}</a></h4>
                    </td>
                    <td class="price">
                        <span>#${parseFloat(item.price).toFixed(2)}</span>
                    </td>
                    <td class="quantity">
                        <input type="number" value="${item.quantity}" min="1" max="10" class="input-qty" data-product-id="${item.product_id}">
                    </td>
                    <td class="total">
                        <span>#${itemTotal}</span>
                    </td>
                    <td class="remove">
                        <a href="#" class="remove-cart-item" data-product-id="${item.product_id}" data-price="${item.price}"><i class="fa fa-trash"></i></a>
                    </td>
                </tr>
            `;
            shoppingCartTotal += parseFloat(itemTotal);
        });

        $('#shoppingcart-items').html(shoppingCartHtml);
        $('#shoppingcart-total').text('#' + shoppingCartTotal.toFixed(2));

        attachQuantityChangeHandler(); // Re-attach the quantity change handler
    }

    // Add item to cart
    $('.add-to-cart-btn').on('click', function(event) {
        event.preventDefault();

        var productId = $(this).data('id');
        var productName = $(this).data('name');
        var productPrice = parseFloat($(this).data('price'));
        var productImage = $(this).data('image');
        var quantity = 1;
        var totalAmount = productPrice * quantity;

        addToCart(userId, productId, productName, productPrice, productImage, quantity, totalAmount);
    });

    function addToCart(userId, productId, productName, productPrice, productImage, quantity, totalAmount) {
        var url = '<?php echo base_url('auth/save_carts'); ?>';

        $.ajax({
            url: url,
            type: 'POST',
            data: {
                user_id: userId,
                product_id: productId,
                quantity: quantity,
                price: productPrice.toFixed(2),
                total_amount: totalAmount.toFixed(2),
                product_name: productName,
                product_image: productImage
            },
            success: function(response) {
                try {
                    var data = JSON.parse(response);
                    if (data.status === 'success') {
                        loadCartItems(userId); // Reload cart items
                    } else {
                        console.error('Server error:', data.message);
                    }
                } catch (e) {
                    console.error('Error parsing JSON response:', e);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error adding to cart:', status, error);
            }
        });
    }

    // Function to attach quantity change handler to input fields
    function attachQuantityChangeHandler() {
        $('.input-qty').off('change').on('change', function() {
            var newQuantity = parseInt($(this).val(), 10);
            var oldQuantity = parseInt($(this).data('old-qty'), 10) || 1;
            if (isNaN(newQuantity) || newQuantity <= 0) {
                newQuantity = oldQuantity;
                $(this).val(newQuantity);
            }

            if (newQuantity !== oldQuantity) {
                var productId = $(this).data('product-id');
                var price = parseFloat($(this).closest('.minicart-item, .cart-item').data('price'));
                var totalAmount = (newQuantity * price).toFixed(2);

                $('.minicart-item[data-id="' + productId + '"], .cart-item[data-id="' + productId + '"]').each(function() {
                    $(this).find('.price ins span, .total span').text('#' + totalAmount);
                    $(this).find('.input-qty').val(newQuantity);
                });

                saveCartToDatabase(userId, productId, newQuantity, price, totalAmount);
                $(this).data('old-qty', newQuantity);
            }
        });
    }

    function saveCartToDatabase(userId, productId, quantity, price, totalAmount) {
        var url = '<?php echo base_url('auth/save_carts'); ?>';

        $.ajax({
            url: url,
            type: 'POST',
            data: {
                user_id: userId,
                product_id: productId,
                quantity: quantity,
                price: parseFloat(price).toFixed(2),
                total_amount: parseFloat(totalAmount).toFixed(2)
            },
            success: function(response) {
                try {
                    var data = JSON.parse(response);
                    if (data.status === 'success') {
                        loadCartItems(userId); // Reload cart items
                    } else {
                        console.error('Server error:', data.message);
                    }
                } catch (e) {
                    console.error('Error parsing JSON response:', e);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error saving cart changes:', status, error);
            }
        });
    }

    // Remove cart item
    $(document).on('click', '.remove-cart-item', function(event) {
        event.preventDefault();

        var productId = $(this).data('product-id');
        var price = $(this).data('price');

        if (confirm('Are you sure you want to remove this item from your cart?')) {
            removeCartItem(productId, userId, price);
        }
    });

    function removeCartItem(productId, userId, price) {
        var url = '<?php echo base_url('auth/remove_cart_item'); ?>';

        $.ajax({
            url: url,
            type: 'POST',
            data: {
                user_id: userId,
                product_id: productId,
                price: price
            },
            success: function(response) {
                try {
                    var data = JSON.parse(response);
                    if (data.status === 'success') {
                        loadCartItems(userId); // Reload cart items
                    } else {
                        console.error('Server error:', data.message);
                    }
                } catch (e) {
                    console.error('Error parsing JSON response:', e);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error removing cart item:', status, error);
            }
        });
    }
});
</script>



<script type="text/javascript">
<?php if ($this->session->flashdata('success')) { ?>
Swal.fire({
    icon: 'success',
    title: '<?php echo $this->session->flashdata('success'); ?>',
});
<?php } else if ($this->session->flashdata('error')) { ?>
Swal.fire({
    icon: 'error',
    title: '<?php echo $this->session->flashdata('error'); ?>',
});
<?php } ?>
        </script>


